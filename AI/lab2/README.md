# Отчет по лабораторной работе 
## по курсу "Искусственый интеллект"

## Нейросетям для распознавания изображений


### Студенты: 

| ФИО       | Роль в проекте                     | Оценка       |
|-----------|------------------------------------|--------------|
| Валентинова Ю.О.|Обучение нейросети, консультация по алгоритмам обучения нейронных сетей, разрезание фотографии |   3   |
| Безлуцкая Е.Н. | Написание символов, разметка данных, обучение нейросети, бэкэнд |      3    |
| Довженко А.А. | Написание символов, обучение нейросети, python эксперт, DevOps|    3   |
| Слесарева Д.С.| Написание символов, обучение нейросети, написание отчёта, мотиватор |  3    |

## Результат проверки

| Преподаватель     | Дата         |  Оценка       |
|-------------------|--------------|---------------|
| Сошников Д.В. |  20.06.19            |        3       |

> Опоздание в выполнении работы. Достигнутая точность неправдоподобно низка - при бинарной классификации необученная сеть должна выдавать точность в районе 50%, поэтому точность 38% скорее всего означает наличие проблемы. Файл .ipynb на самом деле представляет собой .py-файл.

## Тема работы

Построение нейронных сетей для классификации рукописных символов, галочки и крестика.

## Распределение работы в команде

Наша команда собралась вместе, мы долго разбирались, как работают нейронные сети, какой вид должны иметь входные данные. Первые попытки подготовить данные провалилсь, потому что нужно было обозначить классы крестиков и галочек на тестовой выборке.  

## Подготовка данных

Исходное изображение:
![](https://github.com/MAILabs-Edu-AI/lab-neural-networks-vision-julia/blob/master/art.jpg)

Примеры изображений галочки:

<https://github.com/MAILabs-Edu-AI/lab-neural-networks-vision-julia/tree/master/images/checkmarks>

![](https://github.com/MAILabs-Edu-AI/lab-neural-networks-vision-julia/blob/master/images/checkmarks/pic106.png)

Примеры изображений крестика: 

<https://github.com/MAILabs-Edu-AI/lab-neural-networks-vision-julia/tree/master/images/crosses>

![](https://github.com/MAILabs-Edu-AI/lab-neural-networks-vision-julia/blob/master/images/crosses/pic191.png)

При первой попытке подготовить датасет, мы использовали любительскую камеру Nikon D5300, но, из-за особенностей оптики, фотографии получались с кривыми краями. Мы пробовали исправлять перспективу в Adobe Photoshop, но это не помогло. При второй попытке мы использовали онлайн сканер, установленный на телефон одного из участников команды. Далее мы обрезали получившуюся фотографию в Adobe Photoshop. После этого один из участников сделал разрезание изображений. 
```
def load_data(name):
  image = cv2.imread(name)
  width = 608
  height = 1056
  resized = cv2.resize(image, (width, height))
  data = []
  labels = []
  step = 32
  cnt = 0
  for i in range(0, height, step):
    for j in range(0, width, step):
      if cnt == 209:    #data preparation error
        continue
      im = resized[i:i+step, j:j+step]
      arr = np.array(im)
      arr = arr[:,:,0]
      data.append(arr)
      if cnt % 2 == 0:
        labels.append(0)
      else:
        labels.append(1)
      cnt += 1
```

Ссылка на получившийся датасет: <https://github.com/MAILabs-Edu-AI/lab-neural-networks-vision-julia/tree/master/images>

## Загрузка данных

Для правильной работы нейросети необходимо чтобы данные представлялись также, как и в библиотеке keras. Для этого мы обозначаем через labels классы галочек и крестиков.

```
  split_size = 0.3
  index = int(len(data) * (1 - split_size))
  x_train, y_train  = data[index:], labels[index:]
  x_test, y_test = data[:index + 1], labels[:index + 1]
  
  print(x_train[0])
  return (x_train, y_train), (x_test, y_test)
```



## Обучение нейросети

### Полносвязная однослойная сеть
**Результаты**
```
Layer (type)                 Output Shape              Param #   
=================================================================
input_1 (InputLayer)        (None, 512)               0         
_________________________________________________________________  
dense_1 (Dense)             (None, 10)               62506      
=================================================================
Total params: 62,506
Trainable params: 62,506
Non-trainable params: 0
Test loss: 0.675483928572
Test accuracy: 0.3895850386214
```


### Полносвязная многослойная сеть
**Архитектура** - Слой содержит совокупность нейронов с едиными входными сигналами. Число нейронов в слое может быть любым и не зависит от количества нейронов в других слоях. В общем случае сеть состоит из Q слоев, пронумерованных слева направо. Внешние входные сигналы подаются на входы нейронов входного слоя (его часто нумеруют как нулевой), а выходами сети являются выходные сигналы последнего слоя. Кроме входного и выходного слоев в многослойной нейронной сети есть один или несколько скрытых слоев. 
**Результаты**
```
Layer (type)                 Output Shape              Param #   
=================================================================
input_1 (InputLayer)        (None, 512)               0         
_________________________________________________________________  
dense_1 (Dense)             (None, 512)               401920 
_________________________________________________________________
dense_2 (Dense)             (None, 512)               262656       
_________________________________________________________________
dense_3 (Dense)             (None, 10)                5130          
=================================================================
Total params: 669,706
Trainable params: 669,706
Non-trainable params: 0
Test loss: 0.68392508352749
Test accuracy: 0.4674341790218864
```

### Свёрточная сеть
**Архитектура** - Сеть состоит из большого количества слоёв. После начального слоя (входного изображения) сигнал проходит серию свёрточных слоёв, в которых чередуется собственно свёртка и пулинг. Чередование слоёв позволяет составлять «карты признаков» из карт признаков, на каждом следующем слое карта уменьшается в размере, но увеличивается количество каналов.


**Результаты**
```
Train on 189 samples, validate on 439 samples
Epoch 1/12
189/189 [==============================] - 2s 11ms/step - loss: 0.7423 - acc: 0.5238 - val_loss: 0.9048 - val_acc: 0.5034
Epoch 2/12
189/189 [==============================] - 1s 5ms/step - loss: 0.8008 - acc: 0.5503 - val_loss: 0.7106 - val_acc: 0.4966
Epoch 3/12
189/189 [==============================] - 1s 6ms/step - loss: 0.7001 - acc: 0.5238 - val_loss: 0.6900 - val_acc: 0.4897
Epoch 4/12
189/189 [==============================] - 1s 6ms/step - loss: 0.6728 - acc: 0.6243 - val_loss: 0.7056 - val_acc: 0.5034
Epoch 5/12
189/189 [==============================] - 1s 6ms/step - loss: 0.6596 - acc: 0.5979 - val_loss: 0.6833 - val_acc: 0.4920
Epoch 6/12
189/189 [==============================] - 1s 6ms/step - loss: 0.5841 - acc: 0.8519 - val_loss: 0.6739 - val_acc: 0.5421
Epoch 7/12
189/189 [==============================] - 1s 6ms/step - loss: 0.5563 - acc: 0.7249 - val_loss: 0.9583 - val_acc: 0.5034
Epoch 8/12
189/189 [==============================] - 1s 6ms/step - loss: 0.7879 - acc: 0.5503 - val_loss: 0.6777 - val_acc: 0.5216
Epoch 9/12
189/189 [==============================] - 1s 6ms/step - loss: 0.5215 - acc: 0.8624 - val_loss: 0.7779 - val_acc: 0.5262
Epoch 10/12
189/189 [==============================] - 1s 6ms/step - loss: 0.5319 - acc: 0.6402 - val_loss: 0.6862 - val_acc: 0.5831
Epoch 11/12
189/189 [==============================] - 1s 6ms/step - loss: 0.4164 - acc: 0.8730 - val_loss: 0.7730 - val_acc: 0.5877
Epoch 12/12
189/189 [==============================] - 1s 6ms/step - loss: 0.3656 - acc: 0.8783 - val_loss: 0.7407 - val_acc: 0.5923
Test loss: 0.7407038711469646
Test accuracy: 0.5922551263709275
```

## Выводы

Учёные занимаются разработкой искусственных нейронных сетей более 70 лет. Однако до недавнего времени скорость работы нейросетей была слишком низкой, чтобы они могли получить широкое распространение. Сейчас данная технология стала невероятно популярной, поэтому мы с энтузиазмом приступили к решению поставленной задачи. 
Трудоёмкая и длительная часть процесса  — подготовка данных. Помимо того, что сначала мы посчитали не тот вариант, сам процесс разбивания фотографии на равные кусочки оказался не из лёгких. Пригодились навыки Фотошопа и математики. Для того, чтобы нейронная сеть могла корректно решать поставленные задачи, требуется «прогнать» её работу на десятках миллионов наборов входных данных. В нашем случае данных не так много, но результаты вполне неплохие. Обработка фотографий всегда ассоциируется со сверточными нейронными сетями, поэтому результат нас не удивил  - сверточные сети показали себя на практике лучше всего.
